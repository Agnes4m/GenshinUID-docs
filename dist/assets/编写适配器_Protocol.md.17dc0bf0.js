import{_ as l}from"./chunks/PageInfo.vue_vue_type_script_setup_true_lang.13c3af49.js";import{_ as t}from"./chunks/Badge.f3e0fe65.js";import{_ as a,o as s,c as r,k as d,a as e,H as o,Q as n}from"./chunks/framework.4d23d1ec.js";import"./chunks/commonjsHelpers.725317a4.js";const v=JSON.parse('{"title":"早柚协议","description":"","frontmatter":{},"headers":[],"relativePath":"编写适配器/Protocol.md","filePath":"编写适配器/Protocol.md","lastUpdated":null}'),p={name:"编写适配器/Protocol.md"},_={id:"早柚协议",tabindex:"-1"},u=d("a",{class:"header-anchor",href:"#早柚协议","aria-label":'Permalink to "早柚协议<Badge type="warning" text="稍难" />"'},"​",-1),g=n('<p><code>GenshinUID-core</code>（下简称 GsCore）使用 WebSocket 与各 Bot 平台的插件（下简称插件）进行通信。</p><p>WebSocket 消息均使用 text 类型的 UTF-8 编码的 JSON，数据包结构请参阅<a href="./Pack.html">下一节</a>。</p><h2 id="建立连接" tabindex="-1">建立连接 <a class="header-anchor" href="#建立连接" aria-label="Permalink to &quot;建立连接&quot;">​</a></h2><p>插件通过连接 GsCore 的 <code>/ws/{bot_id}</code> 路由建立连接。其中 <code>bot_id</code> 应替换为 Bot 平台的名称，如 <code>NoneBot2</code>。</p><h2 id="消息类型-message" tabindex="-1">消息类型 <code>Message</code> <a class="header-anchor" href="#消息类型-message" aria-label="Permalink to &quot;消息类型 `Message`&quot;">​</a></h2><p>消息由 <code>type</code> 和 <code>data</code> 两部分组成</p><p><code>type</code> 标识此消息的类型，目前有如下类型：</p><ul><li><code>text</code> 纯文本消息</li><li><code>markdown</code> MD消息</li><li><code>buttons</code> 按钮消息</li><li><code>image</code> 图片</li><li><code>image_size</code> 图片大小</li><li><code>file</code> 文件</li><li><code>at</code> 提及</li><li><code>reply</code> 回复</li><li><code>record</code> 音频</li><li><code>node</code> 合并转发</li></ul><p>此外，还有一种特殊的 <code>log_{level}</code> 类型，此类型仅存在于 <code>MessageSend</code> 包中，插件收到此消息，应按照 <code>level</code> 输出 <code>data</code> 中的内容</p><p><code>data</code> 为任意类型，上方列出的类型对应的 <code>data</code> 如下：</p><ul><li><code>text</code> 为文本内容</li><li><code>markdown</code>同样为文本内容（内容带MD格式）</li><li><code>buttons</code>是一个列表，里面可能的值为<code>Button[]</code>或为<code>Button</code></li><li><code>image</code> 为一个 <code>map</code>，内容如下 <ul><li><code>type</code> (url|file|b64) 该图片的 <code>content</code> 类型：url/本地文件/base64</li><li><code>content</code> (string) 该图片内容 --&gt;</li></ul></li><li><code>image</code><ul><li>在 <code>MessageReceive</code> 中，一般为 url</li><li>在 <code>MessageSend</code> 中，为 base64</li></ul></li><li><code>file</code> 为 <code>string</code>，内容为 <code>{文件名}|{文件base64}</code></li><li><code>node</code> 为 <code>Message[]</code>（不允许嵌套 <code>node</code>）</li><li><code>reply</code> 为消息 id</li><li><code>at</code> 为被提及人的 id</li></ul><h2 id="上报消息" tabindex="-1">上报消息 <a class="header-anchor" href="#上报消息" aria-label="Permalink to &quot;上报消息&quot;">​</a></h2><p>Bot 平台接收到消息时，插件应向 core 发送 <code>MessageReceive</code> 包进行上报。</p><p><code>MessageReceive</code> 包内容如下：</p><ul><li><code>bot_id</code> (string) 聊天平台的 id，请与路由的 <code>bot_id</code> 进行区分</li><li><code>bot_self_id</code> (string) 机器人 id，对应聊天平台的机器人 id</li><li><code>msg_id</code> (string) 消息 id，对应聊天平台的消息 id</li><li><code>user_type</code> (<code>group</code>/<code>direct</code>/<code>channel</code>/<code>sub_channel</code>) 当前消息所属类型：群/私聊/频道/子频道</li><li><code>group_id</code> (string) <ul><li>当 <code>user_type</code> 为 <code>group</code> 时，此字段为群号</li><li>当 <code>user_type</code> 为 <code>channel</code> 时，此字段为频道号</li><li>当 <code>user_type</code> 为 <code>sub_channel</code> 时，此字段为子频道号</li></ul></li><li><code>user_id</code> (string) 用户 id</li><li><code>user_pm</code> (integer) 用户权限，越小越高</li><li><code>content</code> (Message[]) 消息正文</li></ul><div class="tip custom-block"><p class="custom-block-title">对 <code>user_pm</code> 的建议</p><p><code>user_pm</code> 建议 <code>&gt;=1</code>；</p><ul><li><p>对于聊天平台身份与 Bot 框架的权限有联系的（如各聊天平台的 SDK），建议遵循下面的聊天平台身份与 <code>user_pm</code> 的映射关系：</p><ul><li>对于 <code>group</code>： <ul><li>群主为 <code>2</code></li><li>群管理员为 <code>3</code></li><li>普通群员为 <code>6</code></li><li>如果存在更低的身份，则使用更低的 <code>user_pm</code></li></ul></li><li>对于 <code>channel</code> 和 <code>sub_channel</code>： <ul><li>频道主为 <code>2</code></li><li>当前频道的频道主为 <code>3</code></li><li>频道管理员为 <code>4</code></li><li>当前频道的管理员为 <code>5</code></li><li>普通成员为 <code>6</code></li><li>如果存在更低的身份，则使用更低的 <code>user_pm</code></li></ul></li><li>对于 <code>direct</code>，非超级用户始终为 <code>6</code></li><li>超级用户始终为 <code>1</code></li></ul></li><li><p>对于无直接联系的（如 Koishi.js），由高到低安排 <code>user_pm</code>，但有以下两条规定</p><ul><li>最高权限使用 <code>1</code></li><li>普通权限使用 <code>6</code></li></ul></li></ul></div><h2 id="发送消息" tabindex="-1">发送消息 <a class="header-anchor" href="#发送消息" aria-label="Permalink to &quot;发送消息&quot;">​</a></h2><p>当插件接收到 core 发送的 <code>MessageSend</code> 包时，需通过 Bot 平台提供的接口，向聊天平台发送消息。</p><ul><li><code>bot_id</code> (string) 聊天平台的 id，请与路由的 <code>bot_id</code> 进行区分</li><li><code>bot_self_id</code> (string) 机器人 id，对应聊天平台的机器人 id</li><li><code>msg_id</code> (string) 消息 id，对应聊天平台的消息 id</li><li><code>target_type</code> (string/null) 当前消息所属类型：群/私聊/频道/子频道</li><li><code>target_id</code> (string/null) 目标 id</li><li><code>content</code> (Message[]) 消息正文</li></ul><p><code>content</code> 中第 1 个元素为 <code>log</code> 类型的消息，则仅输出 log 即可</p>',20);function m(h,b,f,k,P,x){const c=t,i=l;return s(),r("div",null,[d("h1",_,[e("早柚协议"),o(c,{type:"warning",text:"稍难"}),e(),u]),o(i,{readTime:"3",words:"860"}),g])}const T=a(p,[["render",m]]);export{v as __pageData,T as default};
